<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ข้อมูลโรงไฟฟ้า</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="shell">
    <div class="top-controls">
      <div class="left-group">
        <button class="ghost back-btn icon-btn" id="back-btn" type="button" aria-label="กลับหน้ารายการ" title="กลับหน้ารายการ">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M14.5 5.5 8 12l6.5 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="mode-toggle">
          <button class="toggle-btn active" id="mode-meters" type="button">Meters</button>
          <button class="toggle-btn" id="mode-billing" type="button">Billing</button>
        </div>
      </div>
    </div>

    <section class="plant-hero">
      <div>
        <p class="eyebrow">Plant</p>
        <h1 id="plant-name">ชื่อโรงไฟฟ้า</h1>
      </div>
    </section>

    <section class="panel" id="meters-panel">
      <h3>มิเตอร์ / Meters</h3>
      <div class="device-table-wrap">
        <table class="device-table">
          <thead>
            <tr>
              <th style="width: 80px;">Status</th>
              <th>Meter</th>
              <th style="width: 220px;">Serial</th>
            </tr>
          </thead>
          <tbody id="device-rows">
            <tr><td class="empty" colspan="3">กำลังโหลด...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="panel hidden" id="billing-panel">
      <div class="panel-head">
        <h3>บิลค่าไฟ / Billing</h3>
        <div class="panel-actions">
          <button class="primary small-btn" id="bill-new-btn" type="button">สร้างบิลใหม่</button>
        </div>
      </div>
      <div class="bill-meta-note" id="bill-schedule-info">
        <div class="bill-pill-row">
          <span class="pill schedule" id="bill-cycle-pill">สร้างอัตโนมัติทุกวันที่ 5</span>
          <span class="pill schedule alt" id="bill-cutoff-pill">ตัดรอบวันที่ 5</span>
          <button class="pill schedule ghost inline-delete" id="bill-schedule-remove" type="button">รีเซ็ต</button>
        </div>
        <p class="muted small" id="bill-schedule-desc">ระบบจะสร้างบิลอัตโนมัติทุกวันที่ 5 ของเดือน</p>
      </div>

      <div class="summary-grid" id="bill-summary">
        <div class="card summary-card">
          <div class="summary-header">
            <h4>สรุปบิลล่าสุด</h4>
            <span class="pill count" id="bill-total-count">0 ใบ</span>
          </div>
          <div class="kv"><span>ตัดรอบวันที่</span><strong id="bill-auto-day">5</strong></div>
          <div class="kv"><span>รอบล่าสุด</span><strong id="bill-last-period">-</strong></div>
          <div class="kv"><span>ยอดล่าสุด</span><strong id="bill-last-amount">-</strong></div>
          <p class="muted small" id="bill-auto-note">กำหนดรอบบิลในหน้าสร้างบิลใหม่</p>
        </div>
      </div>

      <div class="history-wrap">
        <table class="history-table">
          <thead>
            <tr>
              <th style="width: 90px;">ใบที่</th>
              <th>สร้างจากมิเตอร์</th>
              <th>ช่วงวันที่</th>
              <th style="width: 130px;">อัตรา (฿/kWh)</th>
              <th style="width: 140px;">หน่วยรวม (kWh)</th>
              <th style="width: 140px;">ยอดรวม</th>
              <th style="width: 140px;">การทำงาน</th>
            </tr>
          </thead>
          <tbody id="bill-history-rows">
            <tr><td class="empty" colspan="7">ยังไม่มีบิล</td></tr>
          </tbody>
        </table>
      </div>

      <div class="panel-sub hidden" id="bill-detail">
        <div class="summary-header">
          <h4 id="bill-detail-title">รายละเอียดการใช้ไฟรายวัน</h4>
          <button class="ghost small-btn" id="bill-detail-close" type="button">ปิด</button>
        </div>
        <div class="device-table-wrap">
          <table class="device-table">
            <thead>
              <tr id="bill-detail-head"></tr>
            </thead>
            <tbody id="bill-detail-rows">
              <tr><td class="empty" colspan="6">ยังไม่มีข้อมูลรายวัน</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="panel-sub hidden" id="receipt-history">
        <div class="summary-header">
          <h4 id="receipt-title">ประวัติใบเสร็จ</h4>
          <button class="ghost small-btn" id="receipt-close" type="button">ปิด</button>
        </div>
        <div class="history-wrap">
          <table class="history-table">
            <thead>
              <tr>
                <th style="width: 160px;">เดือน</th>
                <th style="width: 110px;">จำนวนวัน</th>
                <th style="width: 180px;">วันที่ออกใบเสร็จ</th>
                <th style="width: 160px;">ดาวน์โหลด</th>
                <th style="width: 170px;">ตัวอย่าง</th>
              </tr>
            </thead>
            <tbody id="receipt-rows">
              <tr><td class="empty" colspan="5">ยังไม่มีประวัติใบเสร็จ</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <div class="modal hidden" id="receipt-preview-modal" role="dialog" aria-modal="true">
      <div class="modal-content receipt-preview">
        <div class="modal-header">
          <div>
            <h3>ตัวอย่างใบเสร็จ</h3>
            <p class="muted small" id="receipt-preview-month"></p>
          </div>
          <div class="header-actions">
            <button class="primary small-btn" id="receipt-preview-download" type="button">ดาวน์โหลด PDF</button>
            <button class="ghost icon-btn" id="receipt-preview-close" aria-label="ปิด">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="modal-body">
          <div id="receipt-preview-viewport" class="receipt-preview-viewport">
            <div id="receipt-preview-content" class="receipt-preview-content"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="bill-modal" role="dialog" aria-modal="true">
      <div class="modal-content">
        <div class="modal-header">
          <h3>สร้างใบแจ้งค่าไฟ</h3>
          <button class="ghost icon-btn" id="bill-modal-close" aria-label="ปิด">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="field">
            <div class="field-head">
              <div>
                <label>เลือกมิเตอร์</label>
                <p class="muted small">แตะที่การ์ดเพื่อเลือก/ยกเลิก</p>
              </div>
              <div class="field-actions">
                <button class="chip-btn" id="meter-select-all" type="button">เลือกทั้งหมด</button>
                <button class="chip-btn ghost" id="meter-clear" type="button">ล้าง</button>
                <span class="pill count" id="meter-selected-count">0/0</span>
              </div>
            </div>
            <div id="modal-meter-list" class="meter-card-grid"></div>
          </div>
          <div class="field grid-2">
            <div>
              <label for="bill-start">วันที่เริ่ม</label>
              <input type="date" id="bill-start">
            </div>
            <div>
              <label for="bill-end">ถึงวันที่</label>
              <input type="date" id="bill-end">
            </div>
          </div>
          <div class="field grid-2">
            <div>
              <label for="bill-rate">อัตรา (฿/kWh)</label>
              <input type="number" id="bill-rate" step="0.01" placeholder="4.20">
            </div>
            <div>
              <label for="bill-type">ประเภทอัตรา</label>
              <select id="bill-type">
                <option value="flat">Flat rate</option>
                <option value="tou">TOU (Mock)</option>
              </select>
            </div>
          </div>
          <div class="field">
            <label for="bill-calc">คำนวณหน่วยจาก</label>
            <select id="bill-calc">
              <option value="self_use">Self Use (Meter 1)</option>
              <option value="mdb_net">MDB In - MDB Out (Meter 2)</option>
              <option value="solar_in">Solar In (Meter 1)</option>
              <option value="mdb_in">MDB In (Meter 2)</option>
              <option value="mdb_out">MDB Out (Meter 2)</option>
            </select>
          </div>
          <div class="field hidden" id="bill-columns-field">
            <div class="field-head">
              <div>
                <label>คอลัมน์ที่ต้องการแสดง</label>
                <p class="muted small">เลือกข้อมูลที่จะโชว์ในตารางรายวัน</p>
              </div>
              <div class="field-actions">
                <button class="chip-btn" id="columns-select-all" type="button">เลือกทั้งหมด</button>
                <button class="chip-btn ghost" id="columns-clear" type="button">ล้าง</button>
                <span class="pill count" id="columns-selected-count">0/0 เลือก</span>
              </div>
            </div>
            <div class="checkbox-list" id="bill-columns-list"></div>
          </div>
          <div class="field">
            <label for="bill-cutoff">ตัดรอบวันที่</label>
            <select id="bill-cutoff"></select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="ghost small-btn" id="bill-cancel" type="button">ยกเลิก</button>
          <button class="primary" id="bill-confirm" type="button">สร้างบิล</button>
        </div>
      </div>
    </div>

  <script src="./plant.js" defer></script>
</body>
</html>
